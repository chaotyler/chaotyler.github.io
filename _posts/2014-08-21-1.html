---
layout: post
title: JSON介绍
---
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    尽管有许多宣传关于 XML 如何拥有跨平台，跨语言的优势，然而，除非应用于 Web Services，否则，在普通的 Web 应用中，开发者经常为 XML 的解析伤透了脑筋，无论是服务器端生成或处理 XML，还是客户端用 JavaScript 解析 XML，都常常导致复杂的代码，极低的开发效率。实际上，<wbr>对于大多数 Web 应用来说，他们根本不需要复杂的 XML 来传输数据，XML 的扩展性很少具有优势，许多 AJAX 应用甚至直接返回 HTML 片段来构建动态 Web 页面。和返回 XML 并解析它相比，返回 HTML 片段大大降低了系统的复杂性，但同时缺少了一定的灵活性。</wbr>
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    现在， JSON 为 Web 应用开发者提供了另一种数据交换格式。让我们来看看 JSON 到底是什么，同 XML 或 HTML 片段相比，JSON 提供了更好的简单性和灵活性。
</p>
<div style="margin:10px 0px 10px 15px; padding:0px 8px 5px; border-width:1px 0px; border-top-style:solid; border-bottom-style:solid; border-top-color:rgb(170,170,170); border-bottom-color:rgb(170,170,170); outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; float:right; width:300px; color:rgb(51,51,51); clear:right; font-size:0.8em!important; line-height:1.2!important; background-color:rgb(245,237,231)">
    <h2 style="margin:5px 0px; padding:5px 0px 0px; border:0px; outline:0px; vertical-align:baseline; color:rgb(0,0,0); font-size:1.4em!important; font-family:HelveticaNeue-Light,'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial!important">
        Ajax 资源中心
    </h2>
    <p style="margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; color:rgb(34,34,34); line-height:1.5em; margin-top:5px!important; font-size:1.166em!important">
        请访问&nbsp;<a target="_blank" href="http://www.ibm.com/developerworks/cn/ajax/" style="color:rgb(116,82,133); margin:0px; padding:0px; border:0px; outline:0px;font-size:undefined; vertical-align:baseline">Ajax 资源中心</a>，这是有关 Ajax 编程模型信息的一站式中心，包括很多文档、教程、论坛、<wbr>blog、wiki 和新闻。任何 Ajax 的新信息都能在这里找到。</wbr>
    </p>
</div>
<h2 style="margin:5px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:HelveticaNeue-Light,'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial; font-size:1.6em!important">
    JSON 数据格式解析
</h2>
<p style="color:rgb(34,34,34); margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; margin-top:5px!important; font-size:1.166em!important">
    和 XML 一样，JSON 也是基于纯文本的数据格式。由于 JSON 天生是为 JavaScript 准备的，因此，JSON 的数据格式非常简单，您可以用 JSON 传输一个简单的 String，Number，Boolean，<wbr>也可以传输一个数组，或者一个复杂的 Object 对象。</wbr>
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    String，Number 和 Boolean 用 JSON 表示非常简单。例如，用 JSON 表示一个简单的 String “ abc ”，其格式为：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
    <pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">&quot;abc&quot;</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    除了字符&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">&quot;</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">\</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">/</code>&nbsp;和一些控制符（<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">\b</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">\f</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">\n</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">\r</code>，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important"><wbr>\t</wbr></code>）需要编码外，其他 Unicode 字符可以直接输出。下图是一个 String 的完整表示结构：
</p>
<h5 style="margin:5px 0px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; font-size:1.166em!important">
    图 1. String 的完整表示结构
</h5>
<img alt="图 1. String 的完整表示结构" src="https://ci5.googleusercontent.com/proxy/MdD9tGkj7hzeGc9gbTabDjHw31uhHRerps7-zeFx6-hP2g7782OP2_E7MssLv1vh4Zz6gx5-p5I_XG0ETjXRoFdzfEcDfguav3eZ92_-8E6oG2G3=s0-d-e1-ft#http://www.ibm.com/developerworks/cn/web/wa-lo-json/fig001.jpg" width="598" style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px" />
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    一个 Number 可以根据整型或浮点数表示如下：
</p>
<h5 style="margin:5px 0px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; font-size:1.166em!important">
    图 2. Number 的表示结构
</h5>
<img alt="图 2. Number 的表示结构" src="https://ci3.googleusercontent.com/proxy/bq2LCqQkrlzLkX0j5memoLzgx5vFc-Z6Lty-yIlAimsA9SuhBg0d4IWoPwO59uaplR4gn--xw1AtNIIP_0gnRutnzGBRLL_JUJwGyZxkoBNlqX9y=s0-d-e1-ft#http://www.ibm.com/developerworks/cn/web/wa-lo-json/fig002.jpg" width="598" style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px" />
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    这与绝大多数编程语言的表示方法一致，例如：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">12345（整数）
 -3.9e10（浮点数）</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    Boolean 类型表示为&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">true</code>&nbsp;或&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">false</code>&nbsp;。此外，<wbr>JavaScript 中的 null 被表示为&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">null</code>，注意，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">true</code>、<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">false</code>&nbsp;和&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">null</code><wbr>&nbsp;都没有双引号，否则将被视为一个 String 。</wbr></wbr>
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    JSON 还可以表示一个数组对象，使用&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">[]</code>&nbsp;包含所有元素，<wbr>每个元素用逗号分隔，元素可以是任意的 Value，例如，以下数组包含了一个 String，Number，Boolean 和一个 null：</wbr>
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
    <pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">[&quot;abc&quot;,12345,false,null]</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    Object 对象在 JSON 中是用&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">{}</code>&nbsp;包含一系列无序的 Key-Value 键值对表示的，实际上此处的 Object 相当于 Java 中的&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">Map&lt;String, Object&gt;</code>，而不是 Java 的 Class 。注意 Key 只能用 String 表示。
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    例如，一个 Address 对象包含如下 Key-Value：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">city:Beijing
 street:Chaoyang Road
 postcode:100025（整数）</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    用 JSON 表示如下：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
    <pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">{&quot;city&quot;:&quot;Beijing&quot;,&quot;street&quot;:&quot; Chaoyang Road &quot;,&quot;postcode&quot;:100025}</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    其中 Value 也可以是另一个 Object 或者数组，因此，复杂的 Object 可以嵌套表示，例如，一个 Person 对象包含 name 和 address 对象，可以表示如下：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">{&quot;name&quot;:&quot;Michael&quot;,&quot;address&quot;:
    {&quot;city&quot;:&quot;Beijing&quot;,&quot;street&quot;:&quot; Chaoyang Road &quot;,&quot;postcode&quot;:100025}
}</pre>
</div>
<h2 style="margin:5px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:HelveticaNeue-Light,'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial; font-size:1.6em!important">
    JavaScript 处理 JSON 数据
</h2>
<p style="color:rgb(34,34,34); margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; margin-top:5px!important; font-size:1.166em!important">
    上面介绍了如何用 JSON 表示数据，接下来，我们还要解决如何在服务器端生成 JSON 格式的数据以便发送到客户端，以及客户端如何使用 JavaScript 处理 JSON 格式的数据。
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    我们先讨论如何在 Web 页面中用 JavaScript 处理 JSON 数据。我们通过一个简单的 JavaScript 方法就能看到客户端如何将 JSON 数据表示给用户：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">function handleJson() {
  var j={&quot;name&quot;:&quot;Michael&quot;,&quot;address&quot;:
      {&quot;city&quot;:&quot;Beijing&quot;,&quot;street&quot;:&quot; Chaoyang Road &quot;,&quot;postcode&quot;:100025}
  };
  document.write(<a target="_blank" href="http://j.name/" style="color:rgb(17,85,204)">j.name</a>);
  document.write(j.address.city)<wbr>;
 }</wbr></pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    假定服务器返回的 JSON 数据是上文的：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">{&quot;name&quot;:&quot;Michael&quot;,&quot;address&quot;:
    {&quot;city&quot;:&quot;Beijing&quot;,&quot;street&quot;:&quot; Chaoyang Road &quot;,&quot;postcode&quot;:100025}
}</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    只需将其赋值给一个 JavaScript 变量，就可以立刻使用该变量并更新页面中的信息了，相比 XML 需要从 DOM 中读取各种节点而言，JSON 的使用非常容易。我们需要做的仅仅是发送一个 Ajax 请求，然后将服务器返回的 JSON 数据赋值给一个变量即可。有许多 Ajax 框架早已包含了处理 JSON 数据的能力，例如 Prototype（一个流行的 JavaScript 库：<a target="_blank" href="http://prototypejs.org/" style="color:rgb(17,85,204)">http://prototypejs.org</a>）提供了&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">e<wbr>valJSON()</wbr></code>&nbsp;方法，能直接将服务器返回的 JSON 文本变成一个 JavaScript 变量：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important">new Ajax.Request(&quot;<a target="_blank" href="http://url/" style="color:rgb(17,85,204)">http://url</a>&quot;, {
  method: &quot;get&quot;,
  onSuccess: function(transport) {
    var json = transport.responseText.<wbr>evalJSON();
    // TODO: document.write(json.xxx);
  }
 });</wbr></pre>
</div>
<h2 style="margin:5px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:HelveticaNeue-Light,'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial; font-size:1.6em!important">
    服务器端输出 JSON 格式数据
</h2>
<p style="color:rgb(34,34,34); margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; margin-top:5px!important; font-size:1.166em!important">
    下面我们讨论如何在服务器端输出 JSON 格式的数据。以 Java 为例，我们将演示将一个 Java 对象编码为 JSON 格式的文本。
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    将 String 对象编码为 JSON 格式时，只需处理好特殊字符即可。另外，必须用 (<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">&quot;</code>) 而非 (<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">'</code>) 表示字符串：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> static String string2Json(String s) {
    StringBuilder sb = new StringBuilder(s.length()+20);
    sb.append('\&quot;');
    for (int i=0; i&lt;s.length(); i++) {
        char c = s.charAt(i);
        switch (c) {
        case '\&quot;':
            sb.append(&quot;\\\&quot;&quot;);
            break;
        case '\\':
            sb.append(&quot;\\\\&quot;);
            break;
        case '/':
            sb.append(&quot;\\/&quot;);
            break;
        case '\b':
            sb.append(&quot;\\b&quot;);
            break;
        case '\f':
            sb.append(&quot;\\f&quot;);
            break;
        case '\n':
            sb.append(&quot;\\n&quot;);
            break;
        case '\r':
            sb.append(&quot;\\r&quot;);
            break;
        case '\t':
            sb.append(&quot;\\t&quot;);
            break;
        default:
            sb.append(c);
        }
    }
    sb.append('\&quot;');
    return sb.toString();
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    将 Number 表示为 JSON 就容易得多，利用 Java 的多态，我们可以处理 Integer，Long，Float 等多种 Number 格式：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> static String number2Json(Number number) {
    return number.toString();
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    Boolean 类型也可以直接通过&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">toString()</code>&nbsp;方法得到 JSON 的表示：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> static String boolean2Json(Boolean bool) {
    return bool.toString();
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    要将数组编码为 JSON 格式，可以通过循环将每一个元素编码出来：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> static String array2Json(Object[] array) {
    if (array.length==0)
        return &quot;[]&quot;;
    StringBuilder sb = new StringBuilder(array.length &lt;&lt; 4);
    sb.append('[');
    for (Object o : array) {
        sb.append(toJson(o));
        sb.append(',');
    }
    // 将最后添加的 ',' 变为 ']':
    sb.setCharAt(sb.length()-1, ']');
    return sb.toString();
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    最后，我们需要将&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">Map&lt;String, Object&gt;</code>&nbsp;编码为 JSON 格式，因为 JavaScript 的 Object 实际上对应的是 Java 的&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">Map&lt;String, Object&gt;&nbsp;</code>。该方法如下：
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> static String map2Json(Map&lt;String, Object&gt; map) {
    if (map.isEmpty())
        return &quot;{}&quot;;
    StringBuilder sb = new StringBuilder(map.size() &lt;&lt; 4);
    sb.append('{');
    Set&lt;String&gt; keys = map.keySet();
    for (String key : keys) {
        Object value = map.get(key);
        sb.append('\&quot;');
        sb.append(key);
        sb.append('\&quot;');
        sb.append(':');
        sb.append(toJson(value));
        sb.append(',');
    }
    // 将最后的 ',' 变为 '}':
    sb.setCharAt(sb.length()-1, '}');
    return sb.toString();
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    为了统一处理任意的 Java 对象，我们编写一个入口方法&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">toJson(Object)</code>，<wbr>能够将任意的 Java 对象编码为 JSON 格式：</wbr>
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> public static String toJson(Object o) {
    if (o==null)
        return &quot;null&quot;;
    if (o instanceof String)
        return string2Json((String)o);
    if (o instanceof Boolean)
        return boolean2Json((Boolean)o);
    if (o instanceof Number)
        return number2Json((Number)o);
    if (o instanceof Map)
        return map2Json((Map&lt;String, Object&gt;)o);
    if (o instanceof Object[])
        return array2Json((Object[])o);
    throw new RuntimeException(&quot;Unsupported type: &quot; + o.getClass().getName());
 }</pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    我们并未对 Java 对象作严格的检查。不被支持的对象（例如 List）将直接抛出 RuntimeException 。此外，为了保证输出的 JSON 是有效的，<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">Map&lt;String, Object&gt;</code>&nbsp;对象的 Key 也不能包含特殊字符。<wbr>细心的读者可能还会发现循环引用的对象会引发无限递归，例如，<wbr>精心构造一个循环引用的 Map，就可以检测到&nbsp;<code style="margin:0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; line-height:1.5em; font-size:0.95em!important; color:rgb(0,0,0)!important">StackOverflowExcept<wbr>ion</wbr></code>：</wbr></wbr>
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> @Test(expected=<wbr>StackOverflowError.class)
 public void testRecurrsiveMap2Json() {
    Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
    map.put(&quot;key&quot;, map);
    JsonUtil.map2Json(map);
 }</wbr></pre>
</div>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    好在服务器处理的 JSON 数据最终都应该转化为简单的 JavaScript 对象，因此，递归引用的可能性很小。
</p>
<p style="color:rgb(34,34,34); margin-top:0px; margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; font-size:1.166em!important">
    最后，通过 Servlet 或 MVC 框架输出 JSON 时，需要设置正确的 MIME 类型（application/json）和字符编码。<wbr>假定服务器使用 UTF-8 编码，则可以使用以下代码输出编码后的 JSON 文本：</wbr>
</p>
<div style="margin:0px; padding:0px; border:0px; outline:0px; font-size:13px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:15.360000610351563px">
	<pre style="white-space:pre-wrap; margin-top:0px; border:1px solid rgb(204,204,204); outline:0px; font-size:11px; vertical-align:baseline; width:780px; font-family:'Andale Mono','Lucida Console',Monaco,Liberation,fixed,monospace; overflow:auto; clear:right; margin-bottom:6px!important; padding:5px 10px 5px 3px!important; background-color:rgb(247,247,247)!important"> response.setContentType(&quot;<wbr>application/json;charset=UTF-<wbr>8&quot;);
 response.setCharacterEncoding(<wbr>&quot;UTF-8&quot;);
 PrintWriter pw = response.getWriter();
 pw.write(JsonUtil.toJson(obj))<wbr>;
 pw.flush();</wbr></wbr></wbr></wbr></pre>
</div>
<h2 style="margin:5px 0px; padding:0px; border:0px; outline:0px; vertical-align:baseline; font-family:HelveticaNeue-Light,'Helvetica Neue Light','Helvetica Neue',Helvetica,Arial; font-size:1.6em!important">
    小结
</h2>
<p style="color:rgb(34,34,34); margin-bottom:0px; padding-top:6px; padding-bottom:6px; border:0px; outline:0px; vertical-align:baseline; font-family:Arial,sans-serif; line-height:1.5em; margin-top:5px!important; font-size:1.166em!important">
    JSON 已经是 JavaScript 标准的一部分。目前，主流的浏览器对 JSON 支持都非常完善。应用 JSON，我们可以从 XML 的解析中摆脱出来，对那些应用 Ajax 的 Web 2.0 网站来说，JSON 确实是目前最灵活的轻量级方案。
</p>