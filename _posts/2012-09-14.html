---
layout:post
title:FileReader详解与实例---读取并显示图像文件
---
<p style="">
    我们曾经在<a href="http://www.jsmix.com/blog/html5/html5-file-pre-test.html" style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(122,142,18)">《HTML5 中 File 对象初探》</a>中，使用到了FileReader，在那篇文章中，它被用来将一个文件读取为二进制字符串，并通过 xhr 发送到后端形成交互。作为 File API 的一部分，FileReader 专门用于读取文件，根据 W3C 的定义，FileReader 接口<span>&nbsp;</span><strong>&quot;提供一些读取文件的方法与一个包含读取结果的事件模型&quot;</strong>。
</p>
<p class="t_center" style="">
    <img src="http://www.jsmix.com/blog/wp-content/uploads/2010/08/filereader.jpg" alt="HTML5 --- FileReader" title="HTML5 --- FileReader" class="alignnone size-full wp-image-1521" height="200" width="500" style="margin:0px; padding:4px; border:1px solid rgb(224,224,224); font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; background-color:rgb(240,240,240)" />
</p>
<p style="">
    接下来，我们将逐一了解 FileReader 的方法与事件模型，并最终通过一个例子程序来应用 FireRead，在这个例子中，使用支持 FileReader 浏览器的用户将能够通过一个 file input 选择一个图像文件，并<strong>不经过后台</strong>将图像显示在页面中。下面的链接指向这个例子，值得注意的是，到目前为止，只有 Firefox 3.6+ 和 Chrome 6.0+ 实现了 FileReader 接口。
</p>
<p style="">
    <a href="http://www.jsmix.com/blog/wp-content/uploads/2010/08/file-reader-demo.html" class="link_demo" rel="800|600" style="margin:0px 19px; padding:0px 5px 5px 30px; border-width:0px 0px 3px; border-bottom-style:solid; border-bottom-color:rgb(142,193,218); font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(122,142,18); line-height:32px; display:inline-block">点此查看最终效果</a>
</p>
<p style="">
    <span id="more-1490" style="font-family:inherit; font-size:14px; margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; vertical-align:baseline"></span>
</p>
<p style="">
    在这之前的 web 应用程序中，实现这个效果的通常做法是将用户选择的图像文件传送至后端，后端对其进行存储，再将 URL 返回到前端，前端通过这个 URL 来显示图像。 FileReader 的突破在于使得 JavaScript 拥有了处理文件的能力，它可以异步地读取存储在用户电脑中的文件，这里所指的文件，对于 JavaScript 来说是一个 File 对象，FileReader 读取文件的全部方法皆依赖于此，对于 File 对象还不是很了解的话，请先阅读<a href="http://www.jsmix.com/blog/html5/html5-file-pre-test.html" style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(122,142,18)">《HTML5 中 File 对象初探》</a>，这是本文的基础。
</p>
<h3 style="">
    1. 能力检测与创建实例
</h3>
<p style="">
    检测一个浏览器是否支持 FileReader 很容易做到，支持这一接口的浏览器有一个位于 window 对象下的 FileReader 构造函数，如果浏览器有这个构造函数，那么就可以 new 一个 FileReader 的实例来使用。
</p>
<pre class="sh_javascript sh_sourceCode" style="">        <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">if</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">typeof</span> FileReader <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">===</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'undefined'</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">)</span> <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
	        <span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">alert</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot; 您的浏览器未实现 FileReader 接口 &quot;</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">);</span>
	<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">else</span> <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
                <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">var</span> reader <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">new</span> <span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">FileReader</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">();</span>
	        <span class="sh_comment" style="font-family:inherit; color:#ababab; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:italic; font-size:13px; vertical-align:baseline">// do sth.</span>
	<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
</pre>
<h3 style="">
    2. 方法
</h3>
<p style="">
    FileReader 的实例拥有 4 个方法，其中 3 个用以读取文件，另一个用来中断读取。下面的表格列出了这些方法以及他们的参数和功能，需要注意的是 ，无论读取成功或失败，方法并不会返回读取结果，这一结果存储在<span>&nbsp;</span><strong>result</strong>属性中。
</p>
<table style="">
    <thead style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <th style="margin:0px; padding:10px 8px; border-width:0px 0px 2px; border-bottom-style:solid; border-bottom-color:rgb(164,198,23); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            方法名
        </th>
        <th style="margin:0px; padding:10px 8px; border-width:0px 0px 2px; border-bottom-style:solid; border-bottom-color:rgb(164,198,23); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            参数
        </th>
        <th style="margin:0px; padding:10px 8px; border-width:0px 0px 2px; border-bottom-style:solid; border-bottom-color:rgb(164,198,23); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            描述
        </th>
    </tr>
    </thead>
    <tbody style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            abort
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            none
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            中断读取
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            readAsBinaryString
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            file
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            将文件读取为二进制码
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            readAsDataURL
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            file
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            将文件读取为 DataURL
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            readAsText
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            file, [encoding]
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            将文件读取为文本
        </td>
    </tr>
    </tbody>
</table>
<p style="">
    <strong>readAsText：</strong><span>&nbsp;</span>该方法有两个参数，其中第二个参数是文本的编码方式，默认值为 UTF-8。这个方法非常容易理解，将文件以文本方式读取，读取的结果即是这个文本文件中的内容。<br />
    <strong>readAsBinaryString：</strong><span>&nbsp;</span>这个方法在<a href="http://www.jsmix.com/blog/html5/html5-file-pre-test.html" style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(122,142,18)">《HTML5 中 File 对象初探》</a>中已经被使用过一次了，它将文件读取为二进制字符串，通常我们将它传送到后端，后端可以通过这段字符串存储文件。<br />
    <strong>readAsDataURL：</strong><span>&nbsp;</span>这是例子程序中用到的方法，该方法将文件读取为一段以 data: 开头的字符串，这段字符串的实质就是 Data URI，Data URI是一种将小文件直接嵌入文档的方案。这里的小文件通常是指图像与 html 等格式的文件。<a href="http://en.wikipedia.org/wiki/Data_URI_scheme" class="link_external" style="margin:0px 3px 0px 0px; padding:0px 13px 0px 3px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(122,142,18)">点击这里了解更多关于 Data URI 的知识</a>。
</p>
<h3 style="">
    3. 事件
</h3>
<p style="">
    FileReader 包含了一套完整的事件模型，用于捕获读取文件时的状态，下面这个表格归纳了这些事件。
</p>
<table style="">
    <thead style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <th class="w120" style="margin:0px; padding:10px 8px; border-width:0px 0px 2px; border-bottom-style:solid; border-bottom-color:rgb(164,198,23); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; width:120px; color:rgb(122,142,18)">
            事件
        </th>
        <th style="margin:0px; padding:10px 8px; border-width:0px 0px 2px; border-bottom-style:solid; border-bottom-color:rgb(164,198,23); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            描述
        </th>
    </tr>
    </thead>
    <tbody style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onabort
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            中断时触发
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onerror
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            出错时触发
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onload
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            文件读取成功完成时触发
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onloadend
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            读取完成触发，无论成功或失败
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onloadstart
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            读取开始时触发
        </td>
    </tr>
    <tr style="margin:0px; padding:0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline">
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            onprogress
        </td>
        <td style="margin:0px; padding:6px 8px; border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(204,221,170); font-weight:normal; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:middle; text-align:left; color:rgb(122,142,18)">
            读取中
        </td>
    </tr>
    </tbody>
</table>
<p style="">
    文件一旦开始读取，无论成功或失败，实例的 result 属性都会被填充。如果读取失败，则 result 的值为 null ，否则即是读取的结果，绝大多数的程序都会在成功读取文件的时候，抓取这个值。
</p>
<pre class="sh_javascript sh_sourceCode" style="">	reader<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>onload <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">function</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">()</span> <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
		<span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">this</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>result     <span class="sh_comment" style="font-family:inherit; color:#ababab; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:italic; font-size:13px; vertical-align:baseline">// 读取结果</span>
	<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
</pre>
<h3 style="">
    4. 实例
</h3>
<p style="">
    了解了这些知识过后，我们来还原之前的示例。第一步，创建 html 部分，主要包括一个 input 和一个用来呈现结果的 div：
</p>
<pre class="sh_xml sh_sourceCode" style="">        <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&lt;label&gt;</span>请选择一个图像文件：<span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&lt;/label&gt;</span>
<span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&lt;input</span> <span class="sh_type" style="font-family:inherit; color:#c42638; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">type</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;file&quot;</span> <span class="sh_type" style="font-family:inherit; color:#c42638; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">id</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;demo_input&quot;</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">/&gt;</span>
<span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&lt;div</span> <span class="sh_type" style="font-family:inherit; color:#c42638; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">id</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;demo_result&quot;</span><span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&gt;</span>
          <span class="sh_comment" style="font-family:inherit; color:#ababab; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:italic; font-size:13px; vertical-align:baseline">&lt;!-- 这里用来显示读取结果 --&gt;</span>
    <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">&lt;/div&gt;</span>
</pre>
<p style="">
    接下来获取节点，并处理浏览器兼容部分，对于未实现 FileReader 接口的浏览器将给出一个提示并禁用 input，否则监听 input 的 change 事件。
</p>
<pre class="sh_javascript sh_sourceCode" style=""><span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">if</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">typeof</span> FileReader <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">===</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'undefined'</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">)</span><span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
        result<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>innerHTML <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;</span>
<span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&lt;p class='warn'&gt;抱歉，你的浏览器不支持 FileReader</span>

<span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">;</span>
        input<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span><span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">setAttribute</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'disabled'</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">,</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'disabled'</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">);</span>
<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">else</span> <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
        input<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span><span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">addEventListener</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'change'</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">,</span>readFile<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">,</span><span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">false</span> <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">);</span>
<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
</pre>
<p style="">
    最后书写函数 readFile 的代码，当 file input 的 change 事件触发时，调用这个函数，首先获取到 file 对象，并通过 file 的 type 属性来检验文件类型，在这里，我们只允许选择图像类型的文件。然后创建一个 FileReader 实例，并且调用 readAsDataURL 方法读取文件，在实例的 load 事件中，获取到成功读取到的文件内容，并以插入一个 img 节点的方式，显示在页面中。
</p>
<pre class="sh_javascript sh_sourceCode" style=""><span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">function</span> <span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">readFile</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">()</span><span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
        <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">var</span> file <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">this</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>files<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">[</span><span class="sh_number" style="font-family:inherit; color:#da344; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">0</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">];</span>
        <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">if</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(!</span><span class="sh_regexp" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">/image\/\w+/</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span><span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">test</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span>file<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>type<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">))</span><span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
                <span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">alert</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">&quot;请确保文件为图像类型&quot;</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">);</span>
                <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">return</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">false</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">;</span>
        <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
        <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">var</span> reader <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">new</span> <span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">FileReader</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">();</span>
        reader<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span><span class="sh_function" style="font-family:inherit; color:#000000; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">readAsDataURL</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span>file<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">);</span>
        reader<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>onload <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">function</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">(</span>e<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">)</span><span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">{</span>
                result<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>innerHTML <span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">=</span> <span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'&lt;img src=&quot;'</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">+</span><span class="sh_keyword" style="font-family:inherit; color:#a7f6d; margin:0px; padding:0px; border:0px; font-weight:bold; font-style:normal; font-size:13px; vertical-align:baseline">this</span><span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">.</span>result<span class="sh_symbol" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">+</span><span class="sh_string" style="font-family:inherit; color:#2b83ba; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">'&quot; alt=&quot;&quot;/&gt;'</span>
        <span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
<span class="sh_cbracket" style="font-family:inherit; color:#00de; margin:0px; padding:0px; border:0px; font-weight:normal; font-style:normal; font-size:13px; vertical-align:baseline">}</span>
</pre>
<h3 style="">
    参考资料：
</h3>
<ul style="">
    <li style="margin:0px; padding:0px 0px 0px 18px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; line-height:28px; background-color:transparent">
        <a href="http://www.w3.org/TR/FileAPI/#dfn-filereader" class="link_external" style="margin:0px 3px 0px 0px; padding:0px 15px 0px 0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(7,113,162)">W3C File API --- FileReader Interface</a>
    </li>
    <li style="margin:0px; padding:0px 0px 0px 18px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; line-height:28px; background-color:transparent">
        <a href="https://developer.mozilla.org/en/DOM/FileReader" class="link_external" style="margin:0px 3px 0px 0px; padding:0px 15px 0px 0px; border:0px; font-weight:inherit; font-style:inherit; font-size:14px; font-family:inherit; vertical-align:baseline; text-decoration:none; color:rgb(7,113,162)">MDC --- FileReader</a>
    </li>
</ul>
Thanks: <a href="http://www.jsmix.com/blog/html5/file-reader.html">http://www.jsmix.com/blog/html5/file-reader.html</a><br />